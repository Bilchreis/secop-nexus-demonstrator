services:
  gas_dosing:
    build:
      context: .
      dockerfile: Dockerfile_gas_dosing
    ports:
      - '10800:10800'
    stdin_open: true # docker run -i
    tty: true        # docker run -t
  
  reactor_cell:
    build:
      context: .
      dockerfile: Dockerfile_reactor_cell
    ports:
      - '10801:10801'
    stdin_open: true # docker run -i
    tty: true        # docker run -t

  mongodb:
      image:  mongo:7.0.5
      container_name: mongodb
      network_mode: host
      restart: always
      environment:
        - MONGO_INITDB_ROOT_USERNAME=admin
        - MONGO_INITDB_ROOT_PASSWORD=password
        - MONGO_INITDB_DATABASE=bluesky
      volumes:
        - ./data:/data/db
        - ./db_scripts/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
        - "/etc/localtime:/etc/localtime:ro"
        - "/etc/timezone:/etc/timezone:ro"  
      

  tiled:
      depends_on:
        mongodb:
          condition: service_started
      restart: always
      network_mode: host
      environment:
          - TILED_SINGLE_USER_API_KEY=secret
      volumes:
        - '/etc/localtime:/etc/localtime:ro'
        - '/etc/timezone:/etc/timezone:ro'
        - ./data2:/storage/catalog:rw
        - $PWD/tiled_config:/deploy/config:ro
      image: registry.hzdr.de/hzb/bluesky/core/images/bluesky_container:v1.2.0
      command: tiled serve config /deploy/config/config.yml








